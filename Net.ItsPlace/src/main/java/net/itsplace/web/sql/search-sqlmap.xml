<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="web">
    <typeAlias type="net.itsplace.domain.Place" alias="place"/>
    
	<!-- 가맹점 정보가져오기 -->
	<select id="getPlaceInfo" parameterClass="place" resultClass="place">
	    SELECT	*
	    	FROM PLACE
	    WHERE	FID LIMIT #start#, #pageSize#
	</select>
	
	<select id="getPlaceList" resultClass="Place" parameterClass="java.util.Map">
    	 SELECT  sql_calc_found_rows  
    	 		A.ISAUTH, A.FID, A.FNAME, A.LATITUDE, A.LONGITUDE, A.NLDNO, A.MOBILE, A.PHONE1,
    	 		A.IMAGEHOST, A.FILENAME, A.CATEGORY,  A.SERVICETYPE, A.REMARK,
    	 		A.EMAIL,A.PARK, A.CLOSEDDAY, A.OPENDAY, A.WEBSITE, A.INFO, A.QRCODE, A.SAVEDATE, A.EDITDATE,
    	 		S.BASNAME AS SERVICETYPE,
    	 		P.BASNAME AS PLACETYPE,
		   	 	A.FULLADDRESS,
		   	 	A.SIDO,
		   	 	A.GUGUN,
		   	 	A.DONG,
		   	 	A.NEWADDRESS
		 FROM 
		 	PLACE A
		 LEFT OUTER JOIN
		 	PBASCD S
         		ON A.SERVICETYPE = S.BASECD	
         		AND S.GRPCD = 'SERVICETYPE'
		 LEFT OUTER JOIN
		 	PBASCD P
         		ON A.PLACETYPE = P.BASECD	
         		AND P.GRPCD = 'PLACETYPE'
		WHERE A.ISAUTH = 'Y'
         <dynamic>
	    	 <isNotEmpty property="search">
	    	 	AND A.FNAME like CONCAT('%',#search#,'%')
	    	 	OR A.FULLADDRESS like CONCAT('%',#search#,'%')
	    	 	OR MOBILE like CONCAT('%',#search#,'%')
	    	 </isNotEmpty>
    	 </dynamic>
    	 LIMIT #startRow# , #endRow#	
    </select>
</sqlMap>