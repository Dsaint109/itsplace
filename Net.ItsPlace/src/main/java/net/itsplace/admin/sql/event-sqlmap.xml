<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="event">
	
	<typeAlias type="net.itsplace.domain.PlaceEvent" alias="PlaceEvent"/>

    <insert id="savePlaceEvent" parameterClass="PlaceEvent">
         
        INSERT INTO PLACEEVENT(TITLE, CONTENT, FID,  ISAUTH, ISDELETE, STARTDATE, SAVEDATE, ENDDATE)
        VALUES (#title#, #content#, #place.fid#,  #isAuth#, 'N', #startDate#, now(), #endDate#)
         
    </insert>
    <update id="deletePlaceEvent" parameterClass="int">
        UPDATE PLACEEVENT
        SET ISDELETE = 'N'
        WHERE EID =#eid#
    </update>
    <update id="editPlaceEvent" parameterClass="PlaceEvent">
         UPDATE  PLACEEVENT
         SET TITLE = #title# ,
             CONTENT = #content#,
             ISAUTH = #isAuth#, 
             ISDELETE = #isDelete#, 
             STARTDATE = #startDate#,
             ENDDATE = #endDate#
      	WHERE EID = #eid#        
    </update>
    <select id="getPlaceEvent" parameterClass="int" resultClass="PlaceEvent">
        SELECT 
        	EID, 
        	TITLE,
            CONTENT,
            ISAUTH,
            ISDELETE,
            STARTDATE,
            ENDDATE,
            EDITDATE
        FROM PLACEEVENT 
        WHERE EID = #eid#    
    </select>
    <select id="getPlaceEventList" parameterClass="int" resultClass="PlaceEvent">
        SELECT 
        	EID, 
        	TITLE,
            CONTENT,
            ISAUTH,
            ISDELETE,
            STARTDATE,
            ENDDATE,
            EDITDATE
        FROM PLACEEVENT 
        WHERE FID = #fid#    
    </select>
     
	<select id="getPlaceEventDataTable" resultClass="PlaceEvent" parameterClass="java.util.Map" >
    	 SELECT sql_calc_found_rows 
    		EID, 
        	TITLE,
            CONTENT,
            ISAUTH,
            ISDELETE,
            STARTDATE,
            ENDDATE,
            EDITDATE
         FROM PLACEEVENT
         WHERE FID = #fid#   
    	 <dynamic>
	    	 <isNotEmpty property="search">
	    	 	AND TITLE like CONCAT('%',#title#,'%')
	    	 	OR CONTENT like CONCAT('%',#content#,'%')
	    	 </isNotEmpty>
    	 </dynamic>
    	 ORDER BY $sortColumn$ $sortDirection$
    	 LIMIT #startRow#,#endRow#
    </select>  
</sqlMap>