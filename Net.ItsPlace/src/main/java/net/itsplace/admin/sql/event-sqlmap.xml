<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="admin">
	
	<typeAlias type="net.itsplace.domain.PlaceEvent" alias="PlaceEvent"/>
	<resultMap id="PlaceEventJoinPlace" class="PlaceEvent" >
		<result property="eid" column="EID"></result>
		<result property="title" column="TITLE"></result>
		<result property="content" column="CONTENT"></result>
		<result property="isAuth" column="ISAUTH"></result>
		<result property="startDate" column="STARTDATE"></result>
		<result property="endDate" column="ENDDATE"></result>
		<result property="editDate" column="EDITDATE"></result>
		<result property="place.fname" column="FNAME"></result>
	</resultMap>
	
    <insert id="savePlaceEvent" parameterClass="PlaceEvent">
         
        INSERT INTO PLACEEVENT(TITLE, CONTENT, FID,  ISAUTH, ISDELETE, STARTDATE, SAVEDATE, ENDDATE)
        VALUES (#title#, #content#, #place.fid#,  #isAuth#, 'N', #startDate#, now(), #endDate#)
        <selectKey keyProperty="eid" resultClass="java.lang.Integer">
	    	 SELECT last_insert_id()
	    </selectKey>
    </insert>
    <update id="deletePlaceEvent" parameterClass="int">
        UPDATE PLACEEVENT
        SET ISDELETE = 'N'
        WHERE EID =#eid#
    </update>
    <update id="editPlaceEvent" parameterClass="PlaceEvent">
         UPDATE  PLACEEVENT
         SET TITLE = #title# ,
             CONTENT = #content#,
             ISAUTH = #isAuth#, 
             ISDELETE = #isDelete#, 
             STARTDATE = #startDate#,
             ENDDATE = #endDate#
      	WHERE EID = #eid#        
    </update>
    <select id="getPlaceEvent" parameterClass="int" resultClass="PlaceEvent">
        SELECT 
        	EID, 
        	TITLE,
            CONTENT,
            ISAUTH,
            ISDELETE,
            STARTDATE,
            ENDDATE,
            EDITDATE
        FROM PLACEEVENT 
        WHERE EID = #eid#    
    </select>
    <select id="getPlaceEventList" parameterClass="int" resultClass="PlaceEvent">
        SELECT 
        	EID, 
        	TITLE,
            CONTENT,
            ISAUTH,
            ISDELETE,
            STARTDATE,
            ENDDATE,
            EDITDATE
        FROM PLACEEVENT 
        WHERE FID = #fid#    
    </select>
   
     
	<select id="getPlaceEventDataTable" resultClass="PlaceEvent" parameterClass="java.util.Map" >
    	 SELECT sql_calc_found_rows 
    		EID, 
        	TITLE,
            CONTENT,
            ISAUTH,
            ISDELETE,
            STARTDATE,
            ENDDATE,
            EDITDATE
         FROM PLACEEVENT
         WHERE FID = #fid#   
    	 <dynamic>
	    	 <isNotEmpty property="search">
	    	 	AND TITLE like CONCAT('%',#title#,'%')
	    	 	OR CONTENT like CONCAT('%',#content#,'%')
	    	 </isNotEmpty>
    	 </dynamic>
    	 ORDER BY $sortColumn$ $sortDirection$
    	 LIMIT #startRow#,#endRow#
    </select>
    <select id="getPlaceEventDataTableAll" resultMap="PlaceEventJoinPlace" parameterClass="java.util.Map" >
    	 SELECT sql_calc_found_rows 
    		A.EID, 
        	A.TITLE,
            A.CONTENT,
            A.ISAUTH,           
            A.STARTDATE,
            A.ENDDATE,
            A.EDITDATE,
            B.FNAME
         FROM PLACEEVENT A
         INNER JOIN
         	PLACE B
         		ON A.FID = B.FID
         WHERE A.ISDELETE = 'N'   
    	 <dynamic>
	    	 <isNotEmpty property="search">
	    	 	AND TITLE like CONCAT('%',#title#,'%')
	    	 	OR CONTENT like CONCAT('%',#content#,'%')
	    	 </isNotEmpty>
    	 </dynamic>
    	 ORDER BY $sortColumn$ $sortDirection$
    	 LIMIT #startRow#,#endRow#
    </select>         
</sqlMap>