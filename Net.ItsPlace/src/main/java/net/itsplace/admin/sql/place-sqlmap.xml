<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="place">
	
	<typeAlias type="net.itsplace.domain.Place" alias="Place"/>
	<typeAlias type="net.itsplace.domain.Category" alias="Category"/>
	<typeAlias type="net.itsplace.domain.PlaceStamp" alias="PlaceStamp"/>
	<typeAlias type="net.itsplace.domain.Pmedia" alias="Pmedia"/>

	
	<resultMap id="PlaceJoinAddress" class="Place" >
		<result property="fid" column="FID"></result>
		<result property="fname" column="FNAME"></result>
		<result property="latitude" column="LATITUDE"></result>
		<result property="longitude" column="LONGITUDE"></result>
		<result property="nldno" column="NLDNO"></result>
		<result property="phone1" column="PHONE1"></result>
		<result property="mobile" column="MOBILE"></result>
		<result property="imageHost" column="IMAGEHOST"></result>
		<result property="fileName" column="FILENAME"></result>
		<result property="isAuth" column="ISAUTH"></result>
		<result property="remark" column="REMARK"></result>
		<result property="stype" column="STYPE"></result>
		<result property="email" column="EMAIL"></result>
		<result property="park" column="PARK"></result>
		<result property="closedday" column="CLOSEDDAY"></result>
		<result property="openday" column="OPENDAY"></result>
		<result property="website" column="WEBSITE"></result>
		<result property="info" column="INFO"></result>
		<result property="qrcode" column="QRCODE"></result>
		<result property="saveDate" column="SAVEDATE"></result>
		<result property="editDate" column="EDITDATE"></result>
		
		<result property="address.sido" column="SIDO"></result>
		<result property="address.gugun" column="GUGUN"></result>
		<result property="address.bupname" column="BUPNAME"></result>
		<result property="address.hdongname" column="HDONGNAME"></result>
		<result property="address.doroname" column="DORONAME"></result>
		<result property="address.bldmain" column="BLDMAIN"></result>
		<result property="address.bldsubmain" column="BLDSUBMAIN"></result>
		<result property="address.jimain" column="JIMAIN"></result>
		<result property="address.jisubmain" column="JISUBMAIN"></result>
		
		<result property="placeStamp.sid" column="SID"></result>
		
								
	</resultMap>
	
	<select id="getPlaceList" resultMap="PlaceJoinAddress" parameterClass="java.util.Map">
    	 SELECT  sql_calc_found_rows  A.ISAUTH, A.FID, A.FNAME, A.LATITUDE, A.LONGITUDE, A.NLDNO, A.MOBILE, A.PHONE1,
    	 		 A.IMAGEHOST, A.FILENAME, A.CATEGORY,  A.STYPE, A.REMARK,
    	 		 A.EMAIL,A.PARK, A.CLOSEDDAY, A.OPENDAY, A.WEBSITE, A.INFO, A.QRCODE, A.SAVEDATE, A.EDITDATE,
    	 		 PB.BASNAME AS STYPE,
		   	 	 B.SIDO, B.GUGUN, B.BUPNAME, IFNULL(B.HDONGNAME,'') AS HDONGNAME, B.JIMAIN, B.JISUBMAIN, B.DORONAME, B.BLDMAIN, B.BLDSUBMAIN,
		   	 	 IFNULL(C.SID,'') AS SID 
		 FROM PLACE A
		 INNER JOIN PBASCD PB
         	ON A.STYPE = PB.BASECD	
         	AND PB.GRPCD = 'FTYPE'
		 LEFT OUTER JOIN PADDRESS B
			ON A.NLDNO = B.NLDNO
 		 LEFT OUTER JOIN PLACESTAMP C
		    ON C.FID = A.FID
		    AND C.ISDELETE ='N'	
         <dynamic>
	    	 <isNotEmpty property="search">
	    	 	WHERE A.FNAME like CONCAT('%',#search#,'%')
	    	 	or B.HDONGNAME like CONCAT('%',#search#,'%')
	    	 	or MOBILE like CONCAT('%',#search#,'%')
	    	 </isNotEmpty>
    	 </dynamic>
    	 ORDER BY $sortColumn$ $sortDirection$
    	 LIMIT #startRow# , #endRow#	
    </select>
    <select id="getPlace" resultClass="Place">
        SELECT FID, FNAME, NAME, MOBILE, PHONE1, LATITUDE, LONGITUDE, NLDNO, IMAGEHOST, FILENAME, ISAUTH, REMARK, CATEGORY, STYPE
        FROM PLACE
        WHERE FID = #fid#
    </select>
    <insert id="savePlace" parameterClass="Place">
         INSERT INTO Place(FNAME, MOBILE, PHONE1, LATITUDE, LONGITUDE, NLDNO, FILENAME, ISAUTH, REMARK, CATEGORY, STYPE)
         VALUES (#fname#, #mobile#, #phone1#, #latitude#, #longitude#, #nldno#, #fileName#,'N', #remark#, #category#, #stype#)
         
        <selectKey keyProperty="fid" resultClass="java.lang.Integer">
	    	 SELECT last_insert_id()
	    </selectKey>
	    
    </insert>
    <update id="editPlace" parameterClass="Place">
         UPDATE  PLACE
         SET FNAME = #fname# ,
             MOBILE = #mobile#,
             PHONE1 = #phone1#, 
             NLDNO = #nldno#, 
             FILENAME = #fileName#,
             ISAUTH = #isAuth#,
             REMARK = #remark#,
             CATEGORY = #category#,
             stype =#stype#
      	WHERE FID = #fid#        
    </update>
    <update id="enablePlace" parameterClass="int">
         UPDATE  PLACE
         SET ISAUTH = 'Y'             
      	WHERE FID = #fid#        
    </update>
    <update id="disablePlace" parameterClass="int">
         UPDATE  PLACE
         SET ISAUTH = 'N'             
      	WHERE FID = #fid#        
    </update>
   
  
</sqlMap>